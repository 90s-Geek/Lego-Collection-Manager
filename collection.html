<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="90s Geek LEGO Collection Manager — browse and manage your saved LEGO sets.">
    <link rel="icon" type="image/webp" href="images/90s_Geek_logo.webp">
    <title>My LEGO Collection</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles.css?v=8">
    <!-- No page-specific styles needed — collection uses all shared defaults -->
</head>
<body>
    <div class="sidebar-panel"></div>
    <a href="index.html"><img src="images/90s_Geek_logo.webp" alt="90s Geek Logo" class="logo"></a>

    <div class="nav">
        <a href="index.html">SEARCH</a>
        <a href="wantlist.html">WANT LIST</a>
        <a href="stats.html">STATS</a>
    </div>
    <div id="toast-container"></div>

    <h1>Saved Collection</h1>

    <button class="export-btn" onclick="exportCollection()">DOWNLOAD CSV (EXCEL)</button>
    <button class="import-btn" onclick="document.getElementById('import-modal').classList.add('active')">IMPORT CSV</button>

    <!-- Import Modal -->
    <div class="modal-overlay" id="import-modal" onclick="closeImportModal(event)">
        <div class="modal-box" id="import-modal-box">
            <button class="modal-close" onclick="document.getElementById('import-modal').classList.remove('active')">✕</button>
            <h2>Import CSV</h2>
            <div class="import-instructions">
                Upload a CSV with a <span class="import-col">set_num</span> column.<br>
                Optional columns: <span class="import-col">name, theme, year, condition</span><br>
                Missing data will be fetched from Rebrickable.<br>
                Duplicates already in your collection will be skipped.
            </div>
            <input type="file" id="csv-file-input" accept=".csv" style="display:none;" onchange="handleCSVFile(event)">
            <button onclick="document.getElementById('csv-file-input').click()" class="import-file-btn">SELECT CSV FILE</button>
            <div id="import-preview"></div>
        </div>
    </div>

    <div class="controls-panel">
        <div class="controls-panel-title" id="controls-toggle" onclick="toggleControls()" aria-expanded="true" aria-controls="controls-body" role="button" tabindex="0">
            > SORT &amp; FILTER <span class="controls-panel-toggle">▲</span>
        </div>
        <div class="controls-panel-body" id="controls-body">
            <div class="control-row">
                <label>Sort By:</label>
                <select id="sort-select" onchange="applyControls()">
                    <option value="created_at|desc">Date Added (Newest First)</option>
                    <option value="created_at|asc">Date Added (Oldest First)</option>
                    <option value="name|asc">Name (A → Z)</option>
                    <option value="name|desc">Name (Z → A)</option>
                    <option value="year|desc">Year (Newest First)</option>
                    <option value="year|asc">Year (Oldest First)</option>
                    <option value="theme|asc">Theme (A → Z)</option>
                    <option value="condition|asc">Condition (A → Z)</option>
                    <option value="condition|desc">Condition (Z → A)</option>
                </select>
            </div>
            <div class="control-row">
                <label>Theme:</label>
                <select id="filter-theme" onchange="applyControls()">
                    <option value="">All Themes</option>
                </select>
            </div>
            <div class="control-row">
                <label>Year:</label>
                <select id="filter-year" onchange="applyControls()">
                    <option value="">All Years</option>
                </select>
            </div>
            <div class="control-row">
                <label>Condition:</label>
                <select id="filter-condition" onchange="applyControls()">
                    <option value="">All Conditions</option>
                </select>
            </div>
            <div class="control-row">
                <label>Search:</label>
                <input type="text" id="filter-name" placeholder="Type to search by name..." oninput="debouncedFilter()">
            </div>
            <button class="clear-filters-btn" onclick="clearFilters()">✕ CLEAR FILTERS</button>
        </div>
    </div>

    <div class="collection-meta-row">
        <div class="collection-count" id="collection-count"></div>
        <div class="meta-row-controls">
            <button id="bulk-toggle-btn" onclick="toggleBulkMode()" class="bulk-toggle-btn" title="Select multiple sets">☑ SELECT</button>
            <div class="view-toggle">
                <button id="btn-list" class="active" onclick="setView('list')" title="List view">☰</button>
                <button id="btn-grid" onclick="setView('grid')" title="Grid view">⊞</button>
            </div>
        </div>
    </div>


    <ul id="collection-list">
        <li>Loading database...</li>
    </ul>

    <div class="modal-overlay" id="set-modal" onclick="closeModal(event)">
        <div class="modal-box" id="modal-content">
            <button class="modal-close" onclick="document.getElementById('set-modal').classList.remove('active')">✕</button>
        </div>
    </div>

    <nav class="quick-links"></nav>

    <script src="script.js?v=8"></script>

    <!-- Scroll to top -->
    <button id="scroll-top-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Back to top">▲</button>
    <script>
        (function() {
            var btn = document.getElementById('scroll-top-btn');
            window.addEventListener('scroll', function() {
                btn.classList.toggle('visible', window.scrollY > 400);
            }, { passive: true });
        })();
    </script>
</body>
</html>
